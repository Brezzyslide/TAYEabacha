Please create a full-featured NDIS Budget Management system in:

ğŸ“ `src/app/budget-management/`

This module must include:

---

## 1ï¸âƒ£ Participant Budget Setup

File: `ParticipantBudgetForm.tsx`

Fields:
- Client (dropdown filtered by `companyId`)
- NDIS Budget Categories:
  - SIL: total + remaining
  - Community Access: total + remaining
  - Capacity Building: total + remaining
- Allowed Ratios per category (multi-select: 1:1, 1:2, 1:3, 1:4)
- Optional: price overrides per shift type (AM, PM, Active Night, Sleepover)

ğŸ§¾ On Submit:
Save to `ndisBudgets` table:
```ts
{
  clientId,
  companyId,
  sil: { total, remaining, allowedRatios: string[] },
  communityAccess: { ... },
  capacityBuilding: { ... },
  priceOverrides?: {
    AM?: number,
    PM?: number,
    ActiveNight?: number,
    Sleepover?: number
  }
}
2ï¸âƒ£ Connect Shift to Budget Logic
Update NewShiftModal.tsx (in shift-calendar) to include:

Shift Type (auto-calculated or manual)

Funding Category (dropdown: SIL, Access, Capacity)

ğŸ§  Auto-set shiftType based on time:

ts
Copy
Edit
06:00â€“20:00 â†’ AM  
20:00â€“00:00 â†’ PM  
00:00â€“06:00 â†’ Active Night
3ï¸âƒ£ Deduct Budget on Case Note Submission
In CreateCaseNoteModal.tsx:

When a shift is completed and linked to a case note:

Pull shiftType, fundingType, ratio, and hours

Lookup rate from ndisPricing

Calculate:

ts
Copy
Edit
cost = rate Ã— hours Ã— ratioMultiplier
Subtract from participantâ€™s remainingBudget for that category

4ï¸âƒ£ Budget Overview Component
File: BudgetSummaryCard.tsx

Show total, remaining, and used per category

Progress bar visual

Available to Admins + Team Leaders

5ï¸âƒ£ Permissions (Enforced at UI + API Level)
Role	View Budget	Edit Budget	View Deductions	View Pricing
SupportWorker	âœ… own clients only	âŒ	âœ… via case notes	âŒ
Team Leader	âœ…	âœ…	âœ…	âœ…
Admin	âœ…	âœ…	âœ…	âœ…

All budget forms, edit buttons, and summaries must be:

Conditionally rendered using a usePermissions() or hasPermission() helper

Scoped by companyId and clientId at the data level

6ï¸âƒ£ Supporting Files
ParticipantBudgetForm.tsx

BudgetSummaryCard.tsx

useNDISPricing.ts

calculateFundingDeduction.ts

getShiftTypeByTime.ts

roles.ts â†’ update to include "canEditBudget", "canViewPricing"

permissions.ts â†’ map roles to new actions

Use:

TanStack Query

Tailwind + ShadCN

react-hook-form + zod

date-fns

yaml
Copy
Edit
