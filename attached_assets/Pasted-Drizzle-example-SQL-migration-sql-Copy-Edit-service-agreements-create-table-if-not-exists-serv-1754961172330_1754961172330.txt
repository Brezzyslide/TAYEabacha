Drizzle (example SQL migration)

sql
Copy
Edit
-- service_agreements
create table if not exists service_agreements (
  id uuid primary key default gen_random_uuid(),
  company_id uuid not null,
  client_id uuid not null,
  agreement_number text not null,
  start_date date not null,
  end_date date not null,
  plan_nominee_name text,
  plan_nominee_contact text,
  billing_details jsonb,
  base_terms_accepted boolean not null default false,
  custom_terms text,
  status text not null default 'DRAFT',
  created_by uuid not null,
  updated_by uuid not null,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);
create unique index on service_agreements (company_id, agreement_number);
create index on service_agreements (company_id, client_id);

-- service_agreement_items
create table if not exists service_agreement_items (
  id uuid primary key default gen_random_uuid(),
  agreement_id uuid not null references service_agreements(id) on delete cascade,
  ndis_code text not null,
  support_description text not null,
  weeks int not null,
  price_list_id uuid,
  hours_day numeric(10,2) not null default 0,
  hours_evening numeric(10,2) not null default 0,
  hours_active_night numeric(10,2) not null default 0,
  hours_sleepover numeric(10,2) not null default 0,
  hours_saturday numeric(10,2) not null default 0,
  hours_sunday numeric(10,2) not null default 0,
  hours_public_holiday numeric(10,2) not null default 0,
  unit_day numeric(10,2) not null default 0,
  unit_evening numeric(10,2) not null default 0,
  unit_active_night numeric(10,2) not null default 0,
  unit_sleepover numeric(10,2) not null default 0,
  unit_saturday numeric(10,2) not null default 0,
  unit_sunday numeric(10,2) not null default 0,
  unit_public_holiday numeric(10,2) not null default 0,
  notes text,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);
create index on service_agreement_items (agreement_id);

-- signatures
create table if not exists service_agreement_signatures (
  id uuid primary key default gen_random_uuid(),
  agreement_id uuid not null references service_agreements(id) on delete cascade,
  signer_role text not null,
  signer_name text not null,
  signed_at timestamptz not null default now(),
  signed_by_user_id uuid,
  ip_address text,
  user_agent text
);
create index on service_agreement_signatures (agreement_id);

-- tenant terms
create table if not exists tenant_terms_templates (
  id uuid primary key default gen_random_uuid(),
  company_id uuid not null,
  title text not null,
  body text not null,
  is_default boolean not null default false,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);
create index on tenant_terms_templates (company_id, is_default);